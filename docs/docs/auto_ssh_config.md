# 自动化 SSH 免密登录配置脚本

## 功能介绍

这个 Bash 脚本专为需要管理多个 Linux 服务器的用户设计，旨在简化 \*\*SSH 免密登录（passwordless SSH）\*\*的配置过程。通过该脚本，您可以快速地在集群内的所有节点之间建立起相互信任的 SSH 连接，从而无需在每次登录或执行远程命令时手动输入密码。

该脚本的核心工作流程如下：

1.  **生成密钥对**：在每个远程服务器上，脚本会使用 `ssh-keygen` 自动生成一对新的 RSA 密钥（公钥和私钥）。
2.  **收集公钥**：脚本会遍历所有节点，将每个节点的公钥文件 (`id_rsa.pub`) 收集到本地的一个临时文件中。
3.  **整合与分发**：将所有收集到的公钥内容整合成一个完整的 `authorized_keys` 文件。随后，脚本将这个文件分发回集群中的每一个节点，并存放在用户的 `.ssh` 目录下。
4.  **设置权限**：确保 `.ssh` 目录和 `authorized_keys` 文件的权限正确，以符合 SSH 协议的安全要求。

脚本特别使用了 **`expect`** 工具，实现了自动化输入密码，避免了手动交互。这使得整个过程完全自动化，极大地提高了效率，尤其是在配置大规模集群时。

> **安全警告：** 脚本中直接明文存储了远程服务器的密码。这存在潜在的安全风险。在非生产环境中使用时，请务必注意安全，并在使用完毕后立即删除脚本，或将密码替换为更安全的凭证管理方式。

-----

## 使用教程

## 1\. 前置条件

在运行脚本前，请确保您的系统已满足以下条件：

  * **Linux/macOS 环境**：脚本是为类 Unix 系统（如 Linux、macOS）设计的。
  * **安装 `expect` 工具**：此脚本依赖 `expect` 来实现自动化交互。您可以使用包管理器进行安装：
      * 在基于 Debian/Ubuntu 的系统上：`sudo apt-get install expect`
      * 在基于 RedHat/CentOS 的系统上：`sudo yum install expect`
  * **准备节点列表文件**：创建一个文本文件，每行包含一个远程服务器的 IP 地址或主机名。默认文件名为 `node_list_all.txt`。

## 2\. 准备工作

  * **克隆或下载脚本**：将脚本文件保存到您的本地机器上，例如命名为 `auto_ssh_config.sh`。

  * **设置执行权限**：使用 `chmod` 命令为脚本添加可执行权限：

    ```bash
    chmod +x auto_ssh_config.sh
    ```

  * **创建节点列表文件**：在脚本所在的目录下，创建一个名为 `node_list_all.txt` 的文件，并填入您的服务器列表，例如：

    ```
    # node_list_all.txt
    192.168.1.101
    192.168.1.102
    ```

    > 脚本会忽略文件中的空行和以 `#` 开头的注释行。

  * **修改用户名和密码**：打开脚本文件，找到 `USERNAME` 和 `PASSWORD` 变量，将其修改为您的远程服务器用户名和密码。

    ```bash
    readonly USERNAME="your_username"
    readonly PASSWORD="your_password"
    ```

## 3\. 运行脚本

完成上述准备后，您可以在终端中直接运行脚本。

  * **使用默认节点列表文件**：
    ```bash
    ./auto_ssh_config.sh
    ```
  * **指定自定义节点列表文件**：如果您使用的文件名不是 `node_list_all.txt`，可以在运行脚本时作为参数传入。
    ```bash
    ./auto_ssh_config.sh /path/to/your_node_list.txt
    ```

脚本运行后，您将看到实时的输出日志，详细显示了每个步骤的执行情况。当看到 "🎉 所有节点间的 SSH 免密登录配置成功！" 的消息时，表示整个配置过程已顺利完成。


```bash
